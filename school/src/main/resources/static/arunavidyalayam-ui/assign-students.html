<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assign Students to Classes | Arunavidyalayam</title>

    <style>
        body { font-family: "Poppins", sans-serif; background: #f8faff; margin: 0; }
        header { background: linear-gradient(to right, #007bff, #00bfff); color: white; text-align: center; padding: 12px 0; font-size: 1.4rem; }
        .container { width: 90%; max-width: 1100px; margin: 40px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 3px 12px rgba(0,0,0,0.1); }
        select, button { padding: 10px; width: 100%; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        th { background: #007bff; color: white; }
        .assign-btn { background: #28a745; color: white; padding: 6px 10px; border-radius: 4px; cursor: pointer; border: none; }
    </style>

</head>

<body>
<header>Assign Students to Classrooms</header>

<div class="container">

    <h2>Select Classroom</h2>
    <select id="classroomSelect"></select>

    <h2>Unassigned / Transferable Students</h2>
    <table>
        <thead>
        <tr>
            <th>ID</th><th>Name</th><th>Roll No</th><th>Standard</th><th>Action</th>
        </tr>
        </thead>
        <tbody id="studentTableBody"></tbody>
    </table>

</div>

<script>
    const CLASS_API = "http://localhost:8080/api/classrooms";
    const STUDENT_API = "http://localhost:8080/api/students";

    async function loadClassrooms() {
        const res = await fetch(CLASS_API);
        const data = await res.json();
        const select = document.getElementById("classroomSelect");
        select.innerHTML = "<option value=''>Select Classroom</option>";
        data.forEach(c => {
            select.innerHTML += `<option value="${c.id}">${c.name} - ${c.section}</option>`;
        });
    }

    async function loadUnassignedStudents() {
        const res = await fetch(STUDENT_API);
        const data = await res.json();
        const tbody = document.getElementById("studentTableBody");
        tbody.innerHTML = "";

        data.filter(s => !s.classroom).forEach(s => {
            tbody.innerHTML += `
            <tr>
                <td>${s.id}</td>
                <td>${s.name}</td>
                <td>${s.rollNumber}</td>
                <td>${s.standard || "-"}</td>
                <td><button class="assign-btn" onclick="assignStudent(${s.id})">Assign</button></td>
            </tr>`;
        });
    }

    async function assignStudent(studentId) {
        const classId = document.getElementById("classroomSelect").value;
        if (!classId) return alert("⚠ Select a classroom first!");

        const res = await fetch(`${STUDENT_API}/${studentId}`, {
            method: "PUT",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ classroom: { id: classId } })
        });

        if (res.ok) {
            alert("✅ Student assigned successfully!");
            loadUnassignedStudents();
        }
    }

    loadClassrooms();
    loadUnassignedStudents();
</script>

</body>
</html>
